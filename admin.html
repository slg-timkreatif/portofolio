<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Guru Berbagi</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] }, colors: { primary: '#4f46e5', primaryHover: '#4338ca', bgLight: '#f1f5f9', surface: '#ffffff' } } }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .toast-show { animation: slideUp 0.3s ease-out forwards; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        #sidebar { transition: transform 0.3s ease-in-out; }
        /* Mobile Overlay */
        .glass-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-bgLight text-slate-800 antialiased min-h-screen flex items-center justify-center p-0 md:p-4">

    <div id="view-login" class="w-full max-w-5xl bg-surface md:rounded-[2.5rem] shadow-none md:shadow-2xl overflow-hidden flex flex-col md:flex-row min-h-screen md:min-h-[600px] border-0 md:border border-slate-200">
        <div class="w-full md:w-1/2 bg-gradient-to-br from-primary to-violet-600 p-10 text-white flex flex-col justify-center relative overflow-hidden">
            <div class="relative z-10 text-center md:text-left">
                <div class="inline-flex items-center gap-3 mb-6 bg-white/20 p-2 pr-4 rounded-xl backdrop-blur-sm">
                    <div class="w-8 h-8 bg-white rounded-lg flex items-center justify-center text-primary"><i data-lucide="layout-grid" class="w-5 h-5"></i></div>
                    <span class="font-bold tracking-wide text-sm">GURU BERBAGI</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold leading-tight mb-4">Admin Portal</h1>
                <p class="text-indigo-100 opacity-90">Kelola portofolio digital Anda dengan profesional.</p>
            </div>
        </div>
        <div class="w-full md:w-1/2 p-8 md:p-14 flex flex-col justify-center bg-white h-full">
            <div class="mb-8"><h2 class="text-2xl font-bold text-slate-800">Selamat Datang ðŸ‘‹</h2><p class="text-slate-500 text-sm mt-1">Masuk untuk mengelola.</p></div>
            <div class="space-y-5">
                <div><label class="lbl">Email Sekolah</label><input type="email" id="loginEmail" class="inp" placeholder="nama@sekolah.sch.id"></div>
                <div><label class="lbl">PIN Keamanan</label><input type="password" id="loginPin" class="inp" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢"></div>
                <button onclick="doLogin()" id="btnLogin" class="btn-primary w-full shadow-xl">MASUK <i data-lucide="arrow-right" class="w-4 h-4"></i></button>
            </div>
        </div>
    </div>

    <div id="view-dashboard" class="hidden w-full max-w-7xl bg-surface md:rounded-[2.5rem] shadow-none md:shadow-2xl overflow-hidden flex flex-col md:flex-row h-screen md:h-[800px] border-0 md:border border-slate-200 relative">
        <div class="md:hidden flex items-center justify-between p-4 bg-white border-b border-slate-100 z-30 sticky top-0">
            <div class="flex items-center gap-2"><div class="w-8 h-8 bg-primary text-white rounded-lg flex items-center justify-center"><i data-lucide="layout-grid" class="w-4 h-4"></i></div><span class="font-bold text-slate-800">Admin Panel</span></div>
            <button onclick="toggleSidebar()" class="p-2 bg-slate-50 rounded-xl text-slate-600 hover:bg-slate-100"><i data-lucide="menu" class="w-6 h-6"></i></button>
        </div>
        <div id="mobile-overlay" onclick="toggleSidebar()" class="fixed inset-0 z-40 hidden md:hidden glass-overlay transition-opacity"></div>

        <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-72 bg-white md:bg-slate-50 border-r border-slate-200 p-6 flex flex-col transform -translate-x-full md:relative md:translate-x-0 md:w-64 h-full shadow-2xl md:shadow-none transition-transform duration-300">
            <div class="flex items-center justify-between mb-8"><div class="flex items-center gap-2 px-2 text-slate-800"><div class="w-8 h-8 bg-primary text-white rounded-lg flex items-center justify-center"><i data-lucide="layout-grid" class="w-4 h-4"></i></div><span class="font-bold text-sm">Guru Berbagi</span></div><button onclick="toggleSidebar()" class="md:hidden p-2 text-slate-400 hover:text-red-500 bg-slate-50 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button></div>
            <nav class="space-y-1 flex-1 overflow-y-auto custom-scroll pr-1">
                <button onclick="switchTab('profil')" id="nav-profil" class="nav-btn active"><i data-lucide="user"></i> Profil Saya</button>
                <button onclick="switchTab('blog')" id="nav-blog" class="nav-btn"><i data-lucide="pen-tool"></i> Artikel Blog</button>
                <button onclick="switchTab('agenda')" id="nav-agenda" class="nav-btn"><i data-lucide="calendar"></i> Agenda Sekolah</button>
                <button onclick="switchTab('feedback')" id="nav-feedback" class="nav-btn"><i data-lucide="message-circle"></i> Feedback</button>
                <button onclick="switchTab('arsip')" id="nav-arsip" class="nav-btn"><i data-lucide="folder-open"></i> Arsip Dokumen</button>
            </nav>
            <div class="mt-auto pt-6 border-t border-slate-200"><div class="bg-slate-50 md:bg-white p-3 rounded-xl border border-slate-100 mb-3 shadow-sm"><p class="text-[10px] text-slate-400 uppercase font-bold">Login Sebagai</p><p class="text-xs font-bold truncate text-slate-800" id="showNama">User</p></div><button onclick="location.reload()" class="w-full py-2.5 text-red-500 text-xs font-bold bg-red-50 hover:bg-red-100 rounded-xl transition flex items-center justify-center gap-2"><i data-lucide="log-out" class="w-3 h-3"></i> Keluar</button></div>
        </aside>

        <main class="flex-1 p-6 md:p-10 overflow-y-auto bg-white custom-scroll relative w-full">
            
            <div id="tab-profil" class="space-y-8 animate-slide-up">
                <div class="flex justify-between items-end border-b border-slate-100 pb-6"><div><h2 class="text-2xl font-bold text-slate-800">Edit Profil</h2><p class="text-sm text-slate-500">Informasi pribadi dan sosial media.</p></div><a href="#" id="btnPreview" target="_blank" class="hidden text-xs bg-slate-900 text-white px-4 py-2.5 rounded-xl font-bold hover:bg-slate-700 transition items-center gap-2 shadow-lg"><i data-lucide="external-link" class="w-3 h-3"></i> Lihat Web</a></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="col-span-2"><label class="lbl">Foto Profil (URL Gambar)</label><input id="inpFoto" class="inp" placeholder="https://..."></div>
                    <div class="col-span-2"><label class="lbl">Bio Singkat</label><textarea id="inpBio" class="inp h-24 resize-none"></textarea></div>
                    <div><label class="lbl">WhatsApp</label><input id="inpWA" class="inp"></div>
                    <div><label class="lbl">Instagram</label><input id="inpIG" class="inp"></div>
                    <div><label class="lbl">Facebook (Link)</label><input id="inpFB" class="inp"></div>
                    <div><label class="lbl">TikTok (Link)</label><input id="inpTikTok" class="inp"></div>
                </div>
                <button onclick="doSimpanProfil()" id="btnSimpan" class="btn-primary w-full md:w-auto px-8 mt-6"><i data-lucide="save" class="w-4 h-4"></i> SIMPAN PERUBAHAN</button>
            </div>

            <div id="tab-blog" class="hidden space-y-8 animate-slide-up">
                <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-800 flex items-center gap-2" id="blogFormTitle"><i data-lucide="edit-3" class="w-4 h-4 text-primary"></i> Tulis Artikel Baru</h3><button onclick="resetBlogForm()" id="btnCancelBlog" class="hidden text-xs text-red-500 font-bold hover:underline">Batal Edit</button></div>
                    <div class="space-y-4"><input id="blogId" type="hidden"><input id="blogJudul" class="inp font-bold text-lg" placeholder="Judul Artikel"><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><select id="blogKategori" class="inp"><option>Berita Sekolah</option><option>Praktik Baik</option><option>Inovasi</option><option>Opini</option></select><input id="blogGambar" class="inp md:col-span-2" placeholder="URL Gambar Header"></div><textarea id="blogKonten" class="inp h-48 leading-relaxed" placeholder="Isi konten..."></textarea><button onclick="kirimBlog()" id="btnBlog" class="btn-primary w-full bg-orange-500 hover:bg-orange-600">TERBITKAN ARTIKEL</button></div>
                </div>
                <div><h3 class="font-bold text-lg mb-4 text-slate-800">Daftar Artikel Saya</h3><div id="list-blog" class="space-y-3"><p class="text-xs text-slate-400 italic">Memuat...</p></div></div>
            </div>

            <div id="tab-agenda" class="hidden space-y-8 animate-slide-up">
                <div class="bg-green-50 p-6 rounded-3xl border border-green-100">
                    <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-green-800 flex items-center gap-2" id="agendaFormTitle"><i data-lucide="calendar-plus" class="w-4 h-4"></i> Tambah Agenda Sekolah</h3><button onclick="resetAgendaForm()" id="btnCancelAgenda" class="hidden text-xs text-red-500 font-bold hover:underline">Batal Edit</button></div>
                    <div class="space-y-4"><input id="agId" type="hidden"><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><input id="agEvent" class="inp border-green-200" placeholder="Nama Event"><input id="agTanggal" type="date" class="inp border-green-200"></div><input id="agDesk" class="inp border-green-200" placeholder="Deskripsi Singkat"><button onclick="kirimAgenda()" id="btnAgenda" class="btn-primary w-full bg-green-600 hover:bg-green-700">SIMPAN AGENDA</button></div>
                </div>
                <div><h3 class="font-bold text-lg mb-4 text-slate-800">Agenda Aktif</h3><div id="list-agenda" class="space-y-3"><p class="text-xs text-slate-400 italic">Memuat...</p></div></div>
            </div>

            <div id="tab-feedback" class="hidden space-y-6 animate-slide-up">
                <div class="flex justify-between items-center"><h2 class="text-xl font-bold">Feedback Masuk</h2><span class="text-xs bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full font-bold">Moderasi</span></div>
                <div id="list-feedback" class="space-y-3"><p class="text-xs text-slate-400 italic">Memuat...</p></div>
            </div>

            <div id="tab-arsip" class="hidden space-y-6 animate-slide-up">
                <div class="flex justify-between items-center"><h2 class="text-xl font-bold">Arsip Dokumen</h2><button onclick="tambahBaris()" class="text-xs bg-blue-50 text-blue-600 px-4 py-2 rounded-xl font-bold hover:bg-blue-100 transition flex items-center gap-2"><i data-lucide="plus-circle" class="w-4 h-4"></i> Tambah Item</button></div>
                <div id="wadah-link" class="space-y-3 max-h-[500px] overflow-y-auto pr-2 custom-scroll"></div>
                <button onclick="doSimpanProfil()" id="btnSimpanArsip" class="btn-primary w-full mt-4">SIMPAN SEMUA ARSIP</button>
            </div>
        </main>
    </div>

    <div id="toast" class="fixed bottom-6 right-6 bg-slate-900 text-white px-6 py-4 rounded-2xl shadow-2xl translate-y-32 opacity-0 transition-all duration-500 z-[60] flex items-center gap-4 border border-slate-700"><div id="toast-icon"></div><div><h4 class="font-bold text-sm" id="toast-title">Info</h4><p class="text-xs text-slate-400" id="toast-msg">...</p></div></div>
    <style>
        .nav-btn { width: 100%; text-align: left; padding: 14px 18px; border-radius: 16px; font-size: 14px; font-weight: 600; display: flex; gap: 12px; align-items: center; color: #64748b; transition: all 0.2s; border: 1px solid transparent; }
        .nav-btn:hover { background: #f8fafc; color: #1e293b; border-color: #e2e8f0; }
        .nav-btn.active { background: #4f46e5; color: white; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.3); border-color: transparent; }
        .inp { width: 100%; padding: 12px 16px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; font-size: 14px; outline: none; transition: 0.2s; color: #334155; }
        .inp:focus { border-color: #4f46e5; background: #fff; box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1); }
        .lbl { font-size: 11px; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin-bottom: 6px; display: block; letter-spacing: 0.5px; }
        .btn-primary { padding: 14px; border-radius: 14px; font-weight: 700; color: white; background: #4f46e5; display: flex; justify-content: center; align-items: center; gap: 8px; transition: 0.2s; box-shadow: 0 4px 10px rgba(79, 70, 229, 0.2); }
        .btn-primary:hover { background: #4338ca; transform: translateY(-2px); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }
    </style>

    <script>
        // ===============================================
        // âš ï¸ PASTE URL DEPLOY BARU ANDA DI SINI âš ï¸
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyFrBj17fxpQMn44Y4LRORn2yc3HPqvhcLmQfsmmRbhZI471KHGK2UKFjEXIlC7Gv_jTA/exec"; 
        // ===============================================

        let userSession = {};
        let globalBlogs = [];
        let globalAgendas = [];
        lucide.createIcons();

        // UI Logic
        function toggleSidebar() { const sb = document.getElementById('sidebar'); const ov = document.getElementById('mobile-overlay'); if(sb.classList.contains('-translate-x-full')) { sb.classList.remove('-translate-x-full'); ov.classList.remove('hidden'); } else { sb.classList.add('-translate-x-full'); ov.classList.add('hidden'); } }
        function switchTab(t) { ['profil','blog','agenda','feedback','arsip'].forEach(x => { document.getElementById(`tab-${x}`).classList.add('hidden'); document.getElementById(`nav-${x}`).classList.remove('active'); }); document.getElementById(`tab-${t}`).classList.remove('hidden'); document.getElementById(`nav-${t}`).classList.add('active'); if(window.innerWidth < 768) toggleSidebar(); }

        // Data Management
        function loadDashboardData() {
            let guruID = localStorage.getItem("kgb_guruID"); if(!guruID) return;
            let fd = new FormData(); fd.append('payload', JSON.stringify({ action: "get_data", id_guru: guruID }));
            fetch(SCRIPT_URL, { method: 'POST', body: fd }).then(r=>r.json()).then(d=>{ if(d.result === 'success') { globalBlogs = d.dashboard.blogs; globalAgendas = d.dashboard.agendas; renderBlogList(globalBlogs); renderAgendaList(globalAgendas); renderFeedbackList(d.dashboard.feeds); }});
        }

        // Login
        function doLogin() {
            const em = document.getElementById('loginEmail').value; const pn = document.getElementById('loginPin').value; const btn = document.getElementById('btnLogin');
            if(!em || !pn) return showToast("error", "Error", "Isi Email & PIN");
            btn.innerHTML = `<div class="animate-spin w-5 h-5 border-2 border-white border-t-transparent rounded-full"></div> Loading...`; btn.disabled = true;
            let fd = new FormData(); fd.append('payload', JSON.stringify({ action: "login", email: em, pin: pn }));
            fetch(SCRIPT_URL, { method: 'POST', body: fd }).then(r => r.json()).then(d => {
                if(d.result === 'success') {
                    userSession = d.user;
                    if(d.profil_lama) { localStorage.setItem("kgb_guruID", d.profil_lama.id); fillForm(d.profil_lama); document.getElementById('btnPreview').href = `portfolio.html?id=${d.profil_lama.id}`; document.getElementById('btnPreview').classList.remove('hidden'); document.getElementById('btnPreview').classList.add('flex'); }
                    globalBlogs = d.dashboard.blogs; globalAgendas = d.dashboard.agendas; renderBlogList(globalBlogs); renderAgendaList(globalAgendas); renderFeedbackList(d.dashboard.feeds);
                    document.getElementById('showNama').innerText = d.user.nama; document.getElementById('view-login').classList.add('hidden'); document.getElementById('view-dashboard').classList.remove('hidden'); document.getElementById('view-dashboard').classList.add('flex');
                    showToast("success", "Berhasil", "Selamat datang kembali!");
                } else { showToast("error", "Gagal", d.message); }
                btn.innerHTML = `MASUK <i data-lucide="arrow-right" class="w-4 h-4"></i>`; btn.disabled = false; lucide.createIcons();
            });
        }

        // CRUD & Render
        function fillForm(data) { document.getElementById('inpFoto').value = data.foto || ""; document.getElementById('inpBio').value = data.bio || ""; document.getElementById('inpWA').value = data.wa || ""; document.getElementById('inpIG').value = data.ig || ""; document.getElementById('inpFB').value = data.facebook || ""; document.getElementById('inpTikTok').value = data.tiktok || ""; try { let resources = JSON.parse(data.resources); document.getElementById('wadah-link').innerHTML = ""; resources.forEach(r => tambahBaris(r.judul, r.url, r.tipe)); } catch(e) {} }
        
        function renderBlogList(blogs) {
            let html = ""; if(blogs.length === 0) html = `<p class="text-sm text-slate-400 italic bg-slate-50 p-4 rounded-xl text-center">Belum ada artikel.</p>`; else { blogs.forEach(b => { html += `<div class="flex items-center justify-between bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition"><div><h4 class="font-bold text-sm text-slate-800 truncate w-40 md:w-64">${b.judul}</h4><p class="text-[10px] text-slate-400 font-mono">ID: ${b.id}</p></div><div class="flex gap-2"><button onclick="startEditBlog('${b.id}')" class="text-xs bg-blue-50 text-blue-600 px-3 py-2 rounded-lg font-bold hover:bg-blue-100"><i data-lucide="edit-2" class="w-3 h-3"></i></button><button onclick="hapusBlog('${b.id}')" class="text-xs bg-red-50 text-red-500 px-3 py-2 rounded-lg font-bold hover:bg-red-100"><i data-lucide="trash-2" class="w-3 h-3"></i></button></div></div>`; }); } document.getElementById('list-blog').innerHTML = html; lucide.createIcons();
        }
        function renderAgendaList(agendas) {
            let html = ""; if(agendas.length === 0) html = `<p class="text-sm text-slate-400 italic bg-slate-50 p-4 rounded-xl text-center">Belum ada agenda.</p>`; else { agendas.forEach(a => { let tgl = new Date(a.tanggal).toLocaleDateString('id-ID'); html += `<div class="flex items-center justify-between bg-white p-4 rounded-xl border border-slate-100 shadow-sm"><div><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-bold bg-blue-50 text-blue-600 px-2 py-0.5 rounded">${tgl}</span><h4 class="font-bold text-sm text-slate-800">${a.event}</h4></div><p class="text-xs text-slate-500 truncate w-48">${a.deskripsi}</p></div><div class="flex gap-2"><button onclick="startEditAgenda('${a.id}')" class="text-blue-300 hover:text-blue-500 p-2"><i data-lucide="edit-2" class="w-4 h-4"></i></button><button onclick="hapusAgenda('${a.id}')" class="text-slate-300 hover:text-red-500 p-2"><i data-lucide="trash-2" class="w-4 h-4"></i></button></div></div>`; }); } document.getElementById('list-agenda').innerHTML = html; lucide.createIcons();
        }
        function renderFeedbackList(feeds) {
            let html = ""; if(feeds.length === 0) html = `<p class="text-sm text-slate-400 italic bg-slate-50 p-4 rounded-xl text-center">Belum ada feedback.</p>`; else { feeds.forEach(f => { html += `<div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm"><div class="flex justify-between items-start mb-2"><span class="font-bold text-sm text-primary flex items-center gap-2"><i data-lucide="user" class="w-3 h-3"></i> ${f.nama}</span><button onclick="hapusFeedback('${f.id}')" class="text-xs text-red-400 hover:text-red-600 font-bold border border-red-100 px-2 py-1 rounded hover:bg-red-50 transition">Hapus</button></div><p class="text-xs text-slate-600 italic bg-slate-50 p-2 rounded-lg">"${f.pesan}"</p></div>`; }); } document.getElementById('list-feedback').innerHTML = html; lucide.createIcons();
        }

        // Edit Mode
        function startEditBlog(id) {
            let b = globalBlogs.find(x => x.id == id); if(!b) return;
            document.getElementById('blogId').value = id; document.getElementById('blogJudul').value = b.judul; document.getElementById('blogKategori').value = b.kategori; document.getElementById('blogGambar').value = b.gambar; document.getElementById('blogKonten').value = b.konten;
            document.getElementById('blogFormTitle').innerHTML = `<i data-lucide="edit" class="w-4 h-4 text-orange-500"></i> Edit Artikel`; document.getElementById('btnBlog').innerText = "UPDATE ARTIKEL"; document.getElementById('btnBlog').classList.add('bg-blue-600', 'hover:bg-blue-700'); document.getElementById('btnCancelBlog').classList.remove('hidden'); document.getElementById('tab-blog').scrollIntoView({ behavior: 'smooth' }); lucide.createIcons();
        }
        function resetBlogForm() {
            document.getElementById('blogId').value = ""; document.getElementById('blogJudul').value = ""; document.getElementById('blogGambar').value = ""; document.getElementById('blogKonten').value = "";
            document.getElementById('blogFormTitle').innerHTML = `<i data-lucide="edit-3" class="w-4 h-4 text-primary"></i> Tulis Artikel Baru`; document.getElementById('btnBlog').innerText = "TERBITKAN ARTIKEL"; document.getElementById('btnBlog').classList.remove('bg-blue-600', 'hover:bg-blue-700'); document.getElementById('btnCancelBlog').classList.add('hidden'); lucide.createIcons();
        }
        function startEditAgenda(id) {
            let a = globalAgendas.find(x => x.id == id); if(!a) return;
            document.getElementById('agId').value = id; document.getElementById('agEvent').value = a.event;
            let d = new Date(a.tanggal); let day = ("0" + d.getDate()).slice(-2); let month = ("0" + (d.getMonth() + 1)).slice(-2); document.getElementById('agTanggal').value = d.getFullYear()+"-"+(month)+"-"+(day); document.getElementById('agDesk').value = a.deskripsi;
            document.getElementById('agendaFormTitle').innerHTML = `<i data-lucide="edit" class="w-4 h-4 text-orange-500"></i> Edit Agenda`; document.getElementById('btnAgenda').innerText = "UPDATE AGENDA"; document.getElementById('btnCancelAgenda').classList.remove('hidden'); lucide.createIcons();
        }
        function resetAgendaForm() {
            document.getElementById('agId').value = ""; document.getElementById('agEvent').value = ""; document.getElementById('agTanggal').value = ""; document.getElementById('agDesk').value = "";
            document.getElementById('agendaFormTitle').innerHTML = `<i data-lucide="calendar-plus" class="w-4 h-4"></i> Tambah Agenda Sekolah`; document.getElementById('btnAgenda').innerText = "SIMPAN AGENDA"; document.getElementById('btnCancelAgenda').classList.add('hidden'); lucide.createIcons();
        }

        // Actions
        function apiCall(data, callback) { let fd = new FormData(); fd.append('payload', JSON.stringify(data)); fetch(SCRIPT_URL, { method: 'POST', body: fd }).then(r=>r.json()).then(d=>{ if(d.result=='success') { callback(); } else { alert("Gagal: " + d.message); } }); }
        function kirimBlog() {
            let id = document.getElementById('blogId').value; let btn = document.getElementById('btnBlog'); btn.innerText = "Memproses..."; btn.disabled = true;
            let data = { action: id ? "edit_blog" : "simpan_blog", id_post: id, id_guru: localStorage.getItem("kgb_guruID"), judul: document.getElementById('blogJudul').value, kategori: document.getElementById('blogKategori').value, gambar: document.getElementById('blogGambar').value, konten: document.getElementById('blogKonten').value };
            if(!data.judul) { btn.disabled=false; return alert("Isi judul!"); }
            apiCall(data, () => { showToast("success", "Sukses", id ? "Artikel Diupdate" : "Artikel Terbit"); resetBlogForm(); loadDashboardData(); btn.disabled = false; });
        }
        function kirimAgenda() {
            let id = document.getElementById('agId').value; let data = { action: id ? "edit_agenda" : "simpan_agenda", id_agenda: id, event: document.getElementById('agEvent').value, tanggal: document.getElementById('agTanggal').value, deskripsi: document.getElementById('agDesk').value };
            if(!data.event) return alert("Isi Data!"); apiCall(data, () => { showToast("success", "Sukses", "Agenda Tersimpan"); resetAgendaForm(); loadDashboardData(); });
        }
        function hapusBlog(id) { if(confirm("Hapus?")) apiCall({action:"hapus_blog", id_post:id}, () => { showToast("success", "Dihapus", "Artikel hilang"); loadDashboardData(); }); }
        function hapusAgenda(id) { if(confirm("Hapus?")) apiCall({action:"hapus_agenda", id_agenda:id}, () => { showToast("success", "Dihapus", "Agenda hilang"); loadDashboardData(); }); }
        function hapusFeedback(id) { if(confirm("Hapus?")) apiCall({action:"hapus_feedback", id_feed:id}, () => { showToast("success", "Dihapus", "Feedback hilang"); loadDashboardData(); }); }
        function doSimpanProfil() {
            let btn = document.getElementById('btnSimpan'); btn.innerText = "Menyimpan..."; btn.disabled = true;
            let res = []; document.querySelectorAll('.resource-item').forEach(r => { let j = r.querySelector('.inp-judul').value; let u = r.querySelector('.inp-url').value; let t = r.querySelector('.inp-tipe').value; if(j && u) res.push({judul:j, url:u, tipe:t}); });
            let data = { action: "simpan_profil", id_lama: localStorage.getItem("kgb_guruID"), nama: userSession.nama, sekolah: userSession.sekolah, jabatan: userSession.jabatan, bio: document.getElementById('inpBio').value, foto: document.getElementById('inpFoto').value, wa: document.getElementById('inpWA').value, ig: document.getElementById('inpIG').value, facebook: document.getElementById('inpFB').value, tiktok: document.getElementById('inpTikTok').value, resources: JSON.stringify(res) };
            apiCall(data, () => { if(data.id) localStorage.setItem("kgb_guruID", data.id); showToast("success", "Sukses", "Profil Tersimpan"); btn.innerHTML = `<i data-lucide="save" class="w-4 h-4"></i> SIMPAN PERUBAHAN`; btn.disabled = false; });
        }
        function tambahBaris(j="", u="", t="dokumen") { let html = `<div class="resource-item bg-white p-4 rounded-xl border border-slate-200 mb-3 relative group shadow-sm"><button onclick="this.parentElement.remove()" class="absolute top-3 right-3 text-slate-300 hover:text-red-500 bg-slate-50 p-1 rounded"><i data-lucide="trash-2" class="w-4 h-4"></i></button><div class="mb-3 pr-8"><label class="lbl">Judul</label><input class="inp-judul inp font-bold" value="${j}"></div><div class="flex gap-3"><div class="w-2/3"><label class="lbl">URL</label><input class="inp-url inp" value="${u}"></div><div class="w-1/3"><label class="lbl">Tipe</label><select class="inp-tipe inp"><option value="dokumen" ${t=='dokumen'?'selected':''}>Dokumen</option><option value="link" ${t=='link'?'selected':''}>Link</option><option value="video" ${t=='video'?'selected':''}>Video</option></select></div></div></div>`; document.getElementById('wadah-link').insertAdjacentHTML('beforeend', html); lucide.createIcons(); }
        function showToast(type, title, msg) { const t = document.getElementById('toast'); document.getElementById('toast-title').innerText = title; document.getElementById('toast-msg').innerText = msg; document.getElementById('toast-icon').innerHTML = type=='success' ? '<div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center text-white"><i data-lucide="check" class="w-5 h-5"></i></div>' : '<div class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center text-white"><i data-lucide="alert-triangle" class="w-5 h-5"></i></div>'; lucide.createIcons(); t.classList.remove('translate-y-32', 'opacity-0'); setTimeout(() => t.classList.add('translate-y-32', 'opacity-0'), 4000); }
    </script>
</body>
</html>
